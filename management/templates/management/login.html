{% extends 'management/base.html' %}
{% block content %}

<style>
    @keyframes shake {
        0%, 100% { transform: translateX(0); }
        25% { transform: translateX(-10px); }
        75% { transform: translateX(10px); }
    }
    .error-alert {
        background: var(--sync-red);
        color: white;
        border: 4px solid black;
        padding: 20px;
        border-radius: 15px;
        box-shadow: 8px 8px 0px black;
        margin-bottom: 30px;
        width: 100%;
        max-width: 480px;
        font-weight: 900;
        text-transform: uppercase;
        font-size: 0.8rem;
        text-align: center;
        animation: shake 0.4s ease-in-out;
    }

    /* NEW: Show Password Badge Styling */
    .password-toggle {
        position: absolute;
        right: 15px;
        top: 50%;
        transform: translateY(-50%);
        cursor: pointer;
        font-weight: 900;
        font-size: 0.65rem;
        background: black;
        color: white;
        padding: 6px 12px;
        border: 2px solid black;
        border-radius: 8px;
        text-transform: uppercase;
        user-select: none;
        transition: 0.2s;
    }
    .password-toggle:hover {
        transform: translateY(-50%) scale(1.05);
        box-shadow: 3px 3px 0px var(--sync-blue);
    }
</style>

<div style="display: flex; flex-direction: column; justify-content: center; align-items: center; min-height: 90vh; padding: 40px 20px;">
    
    {% if messages %}
        {% for message in messages %}
            <div class="error-alert">
                SIGNAL_ERROR: {{ message }}
            </div>
        {% endfor %}
    {% endif %}

    <div class="brutalist-card" style="width: 100%; max-width: 480px; background: white;">
        
        <div style="display: flex; gap: 10px; margin-bottom: 40px; background: #f1f5f9; padding: 8px; border: 3px solid black; border-radius: 20px;">
            <div id="student-tab" onclick="setMode('STUDENT')" style="flex: 1; text-align: center; padding: 12px; background: var(--sync-blue); color: white; border: 3px solid black; border-radius: 12px; font-weight: 950; font-size: 0.8rem; cursor: pointer; text-transform: uppercase; transition: 0.2s;">
                Student_Mode
            </div>
            <div id="faculty-tab" onclick="setMode('FACULTY')" style="flex: 1; text-align: center; padding: 12px; background: transparent; color: black; border: 3px solid transparent; border-radius: 12px; font-weight: 950; font-size: 0.8rem; cursor: pointer; text-transform: uppercase; transition: 0.2s;">
                Faculty_Mode
            </div>
        </div>

        <div style="text-align: center; margin-bottom: 40px;">
            <div id="portal-badge" style="background: var(--sync-neon); color: black; display: inline-block; padding: 8px 20px; border: 3px solid black; transform: rotate(-1deg); font-weight: 950; font-size: 1rem; box-shadow: 4px 4px 0px black;">
                SECURE_ACCESS_HUB
            </div>
        </div>

        <form method="POST">
            {% csrf_token %}
            <input type="hidden" name="portal_mode" id="portal_mode" value="STUDENT">

            <div style="margin-bottom: 25px;">
                <label class="industrial-label">Username_Identifier</label>
                <input type="text" name="username" required 
                       style="width: 100%; border: 4px solid black; padding: 18px; border-radius: 15px; font-weight: 800; font-size: 1.1rem; box-sizing: border-box; margin-top: 10px; background: #f8fafc;">
            </div>

            <div style="margin-bottom: 35px;">
                <label class="industrial-label">Password</label>
                <div style="position: relative; margin-top: 10px;">
                    <input type="password" name="password" id="id_password" required 
                           style="width: 100%; border: 4px solid black; padding: 18px; padding-right: 80px; border-radius: 15px; font-weight: 800; font-size: 1.1rem; box-sizing: border-box; background: #f8fafc;">
                    <span class="password-toggle" onclick="togglePassword()">Show</span>
                </div>
            </div>

            <button type="submit" id="submit-btn" class="sync-btn" style="width: 100%; padding: 22px; font-size: 1.3rem;">
                INITIALIZE_SESSION
            </button>
        </form>
        
        <div style="margin-top: 30px; text-align: center;">
            <a id="reg-link" href="{% url 'register' %}" style="font-weight: 900; text-transform: uppercase; font-size: 0.8rem; color: var(--sync-blue); text-decoration: none;">New_Registration â†’</a>
        </div>
    </div>
</div>

<script>
    // NEW: Function to switch between Password and Text
    function togglePassword() {
        const passwordField = document.getElementById('id_password');
        const toggleBtn = document.querySelector('.password-toggle');
        
        if (passwordField.type === 'password') {
            passwordField.type = 'text';
            toggleBtn.innerText = 'Hide';
            toggleBtn.style.background = 'var(--sync-blue)'; // Highlight when active
        } else {
            passwordField.type = 'password';
            toggleBtn.innerText = 'Show';
            toggleBtn.style.background = 'black';
        }
    }
    
    function setMode(mode) {
        const sTab = document.getElementById('student-tab');
        const fTab = document.getElementById('faculty-tab');
        const modeInput = document.getElementById('portal_mode');
        const submitBtn = document.getElementById('submit-btn');
        const regLink = document.getElementById('reg-link');
        const badge = document.getElementById('portal-badge');

        modeInput.value = mode;

        if (mode === 'STUDENT') {
            sTab.style.background = 'var(--sync-blue)';
            sTab.style.color = 'white';
            sTab.style.borderColor = 'black';
            fTab.style.background = 'transparent';
            fTab.style.color = 'black';
            fTab.style.borderColor = 'transparent';
            submitBtn.style.background = 'var(--sync-blue)';
            regLink.href = "{% url 'register' %}";
            badge.innerText = "SECURE_ACCESS_HUB";
        } else {
            fTab.style.background = 'black';
            fTab.style.color = 'white';
            fTab.style.borderColor = 'black';
            sTab.style.background = 'transparent';
            sTab.style.color = 'black';
            sTab.style.borderColor = 'transparent';
            submitBtn.style.background = 'black';
            regLink.href = "{% url 'faculty_register' %}";
            badge.innerText = "COMMAND_AUTHORIZATION";
        }
    }
</script>
{% endblock %}